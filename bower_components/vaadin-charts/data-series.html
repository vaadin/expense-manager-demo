<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="configuration-reader.html">

<script>DataSeries=Polymer({is:"data-series",behaviors:[VaadinCharts.ConfigurationReaderBehavior],properties:{drilldown:{type:Boolean,value:!1},data:{type:Array},_seriesConf:{type:Object,value:function(){return{}}},_seriesIndex:Number,_observer:Object},observers:["_dataChanged(data.splices)"],_reloadConfiguration:function(){this._seriesConf={},this._initConfiguration(),!this._seriesConf.hasOwnProperty("data")&&this.data&&(this._seriesConf.data=this.data),this.drilldown?this._seriesIndex=this._parentChart()._addDrilldownSeries(this._seriesConf):this._seriesIndex=this._parentChart()._addSeries(this._seriesConf)},_dataChanged:function(){void 0!=this._seriesIndex&&this._parentChart().isInitialized()?this._updateChartData(this.data):this._seriesConf.data=this.data},_updateChartData:function(t){this.drilldown?this._parentChart().chart.drilldown.series[this._seriesIndex].setData(t):this._parentChart().chart.series[this._seriesIndex].setData(t)},_ignoredNodes:["#text","#comment","data"],_evalJavascript:function(t){return 0===t.indexOf("function")||0===t.indexOf("Date.UTC")||0===t.indexOf("[")},_parentChart:function(){for(var t=Polymer.dom(this.root).parentNode;void 0===t._addSeries;)t=t.parentNode;return t},_loadData:function(){for(var t=Polymer.dom(this),e=0;e<t.childNodes.length;e++){var i=t.childNodes[e],s=i.nodeName.toLowerCase(),a=this._toCamelCase(s);if("data"===a){var r;if(this._hasPointNodes(i)){r=[];for(var o=0;o<i.childNodes.length;o++)this._isPointNode(i.childNodes[o])&&r.push(this._parsePoint(i.childNodes[o]))}else{var n=i.textContent.replace(/(\n)/gm," ");r="["+n+"]"}this._setProperty(a,r)}}},_parsePoint:function(t){for(var e={},i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(this._hasOnlyTextContent(s)){var a=this._toCamelCase(s.nodeName.toLowerCase());if("date"===a)if(void 0===e.x){var r=this._parseDate(s.textContent);void 0!==r?e.x=r:console.log("Unable to parse date: "+s.textContent)}else console.log("x value is already defined for this point, '"+s.textContent+"' couldn't be set");else void 0===e[a]?e[a]=this._parseAttribute(s.textContent):console.log(a+" value is already defined for this point, '"+s.textContent+"' couldn't be set")}}return this._loadConfiguration(e,t),e},_parseDate:function(t){if(this._isValidDate(t))return Date.parse(t)},_isValidDate:function(t){try{var e=new Date(t);return 0===e.toISOString().indexOf(t)&&"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}catch(t){}return!1},_hasPointNodes:function(t){var e=Array.prototype.slice.call(t.children,0);return e.length>0&&e.filter(this._isPointNode).length>0},_isPointNode:function(t){return 1===t.nodeType&&"point"===t.nodeName.toLowerCase()},_setProperty:function(t,e){var i=this._parseAttribute(e);void 0!==i&&(void 0===this._seriesConf[t]?this._seriesConf[t]=i:"data"===t&&Array.prototype.push.apply(this._seriesConf[t],i))},created:function(){this._seriesConf=this.properties._seriesConf.value()},_initialize:function(){this._initConfiguration(),this.drilldown?this._seriesIndex=this._parentChart()._addDrilldownSeries(this._seriesConf):this._seriesIndex=this._parentChart()._addSeries(this._seriesConf)},_initConfiguration:function(){var t=Polymer.dom(this);this._cleanNode(t),this._loadFromNode(this._seriesConf,t.node),this._loadConfiguration(this._seriesConf,t),this._loadData(),this._addDataPointsObserver()},_addDataPointsObserver:function(){if(MutationObserver&&!this._observer){var t=Polymer.dom(this).querySelectorAll("data");if(t&&t.length>0){this._observer=new MutationObserver(this._reloadData.bind(this));for(var e=0;e<t.length;e++)this._observer.observe(t[e],{attributes:!1,childList:!0,characterData:!0,characterDataOldValue:!1,subtree:!0})}}},_reloadData:function(){this._seriesConf.data=[],this._loadData(),this._updateChartData(this._seriesConf.data)}});</script>
</head><body></body></html>