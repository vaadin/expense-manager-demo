<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="../vaadin-date-picker.html">
  <script src="common.js"></script>
</head>

<body>

  <test-fixture id="datepicker">
    <template>
      <vaadin-date-picker></vaadin-date-picker>
    </template>
  </test-fixture>

  <test-fixture id="datepicker-wrapped">
    <template>
      <div style="height: 100px; overflow: scroll">
        <div style="height: 1000px">
          <vaadin-date-picker></vaadin-date-picker>
        </div>
      </div>
    </template>
  </test-fixture>

  <script>describe("Basic features",function(){var e;beforeEach(function(){e=fixture("datepicker")}),afterEach(function(t){e.async(t,1)}),it("should have default value",function(){expect(e.value).to.equal("")}),it("should notify value change",function(){var t=sinon.spy();e.addEventListener("value-changed",t),e.value="2000-02-01",expect(t.calledOnce).to.be["true"]}),it("should open with open call",function(t){e.addEventListener("iron-overlay-opened",function(){t()}),e.open()}),it("should close with close call",function(t){e.addEventListener("iron-overlay-opened",function(){e.close()}),e.addEventListener("iron-overlay-closed",function(){t()}),e.open()}),it("should open on input tap",function(t){e.addEventListener("iron-overlay-opened",function(){t()}),tap(e.$.input)}),it("should open on label tap",function(t){e.addEventListener("iron-overlay-opened",function(){t()}),tap(e.$.label)}),it("should scroll to today by default",function(t){var n=sinon.spy(e.$.overlay,"scrollToDate");e.addEventListener("iron-overlay-opened",function(){expect(monthsEqual(n.firstCall.args[0],new Date)).to.be["true"],t()}),e.open()}),it("should scroll to initial position",function(t){e.initialPosition="2016-01-01";var n=new Date(2016,0,1),o=sinon.spy(e.$.overlay,"scrollToDate");e.addEventListener("iron-overlay-opened",function(){expect(o.firstCall.args[0]).to.eql(n),t()}),e.open()}),it("should remember the original initial position on reopen",function(t){e.initialPosition=null,e.open(),e.async(function(){var n=e.$.overlay.initialPosition;e.close(),e.open(),e.async(function(){expect(e.$.overlay.initialPosition).to.eql(n),t()},1)},1)}),it("should scroll to selected value by default",function(t){var n=sinon.spy(e.$.overlay,"scrollToDate");e.value="2000-02-01",e.addEventListener("iron-overlay-opened",function(){expect(monthsEqual(n.firstCall.args[0],new Date(2e3,1,1))).to.be["true"],t()}),e.open()}),it("should close on overlay date tap",function(t){e.addEventListener("iron-overlay-closed",function(){t()}),e.addEventListener("iron-overlay-opened",function(){Polymer.Base.fire("date-tap",{},{bubbles:!0,node:e.$.overlay})}),e.open()}),it("should focus the input on overlay close",function(t){var n=sinon.spy(e.$.inputcontainer,"focus");e.addEventListener("iron-overlay-closed",function(){expect(n.called).to.be["true"],t()}),e.addEventListener("iron-overlay-opened",function(){expect(n.called).to.be["false"],e.close()}),e.open()}),it("should not have label defined by default",function(){expect(e.label).to.be.undefined}),it("label should be bound to label element",function(){e.label="This is LABEL",expect(e.$.label.innerHTML).to.eql("This is LABEL")}),it("should clear the value",function(){e.value="2000-02-01",tap(e.$.clear),expect(e.value).to.equal("")}),it("should format display correctly",function(){e.value="2000-02-01",expect(e.$.input.bindValue).to.equal("2/1/2000"),e.value="1999-12-31",expect(e.$.input.bindValue).to.equal("12/31/1999")}),it("should not show clear icon",function(t){expect(e.$.clear.clientHeight).to.equal(0),e.value="2000-02-01",expect(e.$.clear.clientHeight).to.equal(0),e.value="",e.addEventListener("iron-overlay-opened",function(){expect(e.$.clear.clientHeight).to.equal(0),t()}),e.open()}),it("should show clear icon",function(t){e.value="2000-02-01",e.addEventListener("iron-overlay-opened",function(){isFullscreen(e)?expect(e.$.overlay.$.clear.clientHeight).not.to.equal(0):expect(e.$.clear.clientHeight).not.to.equal(0),t()}),e.open()}),it("should open by tapping the calendar icon",function(t){tap(e.$.calendar),e.addEventListener("iron-overlay-opened",function(){t()})}),it("should scroll to a date on open",function(t){var n=sinon.spy(e.$.overlay,"scrollToDate"),o=0;e.addEventListener("iron-overlay-opened",function(){expect(n.called).to.be["true"],n.reset(),2===o?t():2>o&&e.close(),o++}),e.addEventListener("iron-overlay-closed",function(){e.open()}),e.open()}),it("should not change datepicker width",function(){e.style.display="inline-block",e.value="2000-01-01";var t=e.clientWidth;e.open(),expect(e.clientWidth).to.equal(t)}),describe("window scroll realign",function(){beforeEach(function(t){e.addEventListener("iron-overlay-opened",function(){e.async(t,100)}),e.async(function(){e.open()},100)}),it("should realign on window scroll",function(t){var n=sinon.spy(e,"_updateAlignmentAndPosition");Polymer.Base.fire("scroll",{},{node:window}),e.async(function(){expect(n.called).to.be["true"],t()},100)}),it("should realign on container scroll",function(t){e.close();var n=fixture("datepicker-wrapped"),o=n.querySelector("vaadin-date-picker");o.addEventListener("iron-overlay-opened",function(){var e=sinon.spy(o,"_updateAlignmentAndPosition");n.scrollTop+=100,o.async(function(){expect(e.called).to.be["true"],t()},100)}),o.open()}),it("should not realign on year/month scroll",function(t){var n=sinon.spy(e,"_updateAlignmentAndPosition");e.$.overlay.$.yearScroller.$.scroller.scrollTop+=100,e.async(function(){expect(n.called).to.be["false"],t()},1)}),it("should not realign once closed",function(t){e.addEventListener("iron-overlay-closed",function(){var n=sinon.spy(e,"_updateAlignmentAndPosition");Polymer.Base.fire("scroll",{},{node:window}),e.async(function(){expect(n.called).to.be["false"],t()},1)}),e.close()})}),describe("value property formats",function(){it("should accept ISO format",function(){var t=new Date(0,1,3);e.value="0000-02-03",t.setFullYear(0),expect(e._selectedDate).to.eql(t),e.value="+010000-02-03",t.setFullYear(1e4),expect(e._selectedDate).to.eql(t),e.value="-010000-02-03",t.setFullYear(-1e4),expect(e._selectedDate).to.eql(t)}),it("should not accept non-ISO formats",function(){e.value="03/02/01",expect(e.value).to.equal(""),expect(e._selectedDate).to.be["null"],e.value="2010/02/03",expect(e.value).to.equal(""),expect(e._selectedDate).to.be["null"],e.value="03/02/2010",expect(e.value).to.equal(""),expect(e._selectedDate).to.be["null"],e.value="3 Feb 2010",expect(e.value).to.equal(""),expect(e._selectedDate).to.be["null"],e.value="Feb 3, 2010",expect(e.value).to.equal(""),expect(e._selectedDate).to.be["null"]}),it("should output ISO format",function(){var t=new Date(0,1,3);t.setFullYear(0),e._selectedDate=t,expect(e.value).to.equal("0000-02-03"),t.setFullYear(1e4),e._selectedDate=new Date(t.getTime()),expect(e.value).to.equal("+010000-02-03"),t.setFullYear(-1e4),e._selectedDate=new Date(t.getTime()),expect(e.value).to.equal("-010000-02-03")})}),describe("i18n",function(){beforeEach(function(t){e.set("i18n.weekdaysShort","su_ma_ti_ke_to_pe_la".split("_")),e.set("i18n.firstDayOfWeek",1),e.set("i18n.formatDate",function(e){return e?[e.getDate(),e.getMonth()+1,e.getFullYear()].join("."):void 0}),e.set("i18n.today","Tänään"),e.set("i18n.cancel","Peruuta"),e.async(t)}),it("should notify i18n mutation to children",function(){var t=e.$.overlay.$.scroller.$.scroller.querySelector("vaadin-month-calendar"),n=t.$.monthGrid.querySelectorAll("div.weekday"),o=Array.prototype.map.call(n,function(e){return e.textContent});expect(o).to.eql(["ma","ti","ke","to","pe","la","su"])}),it("should reflect value in overlay label",function(){e.value="2000-02-01",expect(e.$.overlay.$.input.value).to.equal("1.2.2000")}),it("should display buttons in correct locale",function(){expect(e.$.overlay.$.todayButton.textContent.trim()).to.equal("Tänään"),expect(e.$.overlay.$.cancelButton.textContent.trim()).to.equal("Peruuta")})}),describe("Disabled",function(){beforeEach(function(){e.disabled=!0}),it("dropdown should not open",function(){e.open(),expect(e.$.dropdown.opened).to.be.equal(!1)}),it("calendar icon should be hidden",function(){expect(e.$.calendar.hidden).to.be.equal(!0)}),it("should not be focusable",function(){expect(e.$.inputcontainer.tabIndex).to.equal(-1)})}),describe("Readonly",function(){beforeEach(function(){e.readonly=!0}),it("dropdown should not open",function(){e.open(),expect(e.$.dropdown.opened).to.be.equal(!1)}),it("calendar icon should be hidden",function(){expect(e.$.calendar.hidden).to.be.equal(!0)}),it("should be focusable",function(){expect(e.$.inputcontainer.tabIndex).to.equal(0)})})});</script>




</body></html>