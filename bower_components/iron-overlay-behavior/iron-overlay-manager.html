<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="iron-overlay-backdrop.html"><script>Polymer.IronOverlayManagerClass=function(){this._overlays=[],this._minimumZ=101,this._backdropElement=null,Polymer.Gestures.add(document,'tap',null),document.addEventListener('tap',this._onCaptureClick.bind(this),!0),document.addEventListener('focus',this._onCaptureFocus.bind(this),!0),document.addEventListener('keydown',this._onCaptureKeyDown.bind(this),!0)},Polymer.IronOverlayManagerClass.prototype={constructor:Polymer.IronOverlayManagerClass,get backdropElement(){return this._backdropElement||(this._backdropElement=document.createElement('iron-overlay-backdrop')),this._backdropElement},get deepActiveElement(){for(var a=document.activeElement||document.body;a.root&&Polymer.dom(a.root).activeElement;)a=Polymer.dom(a.root).activeElement;return a},_bringOverlayAtIndexToFront:function(b){var c=this._overlays[b];if(c){var d=this._overlays.length-1,e=this._overlays[d];if(e&&this._shouldBeBehindOverlay(c,e)&&d--,!(b>=d)){var f=Math.max(this.currentOverlayZ(),this._minimumZ);for(this._getZ(c)<=f&&this._applyOverlayZ(c,f);b<d;)this._overlays[b]=this._overlays[b+1],b++;this._overlays[d]=c}}},addOrRemoveOverlay:function(b){b.opened?this.addOverlay(b):this.removeOverlay(b)},addOverlay:function(b){var c=this._overlays.indexOf(b);if(0<=c)return this._bringOverlayAtIndexToFront(c),void this.trackBackdrop();var d=this._overlays.length,e=this._overlays[d-1],f=Math.max(this._getZ(e),this._minimumZ),g=this._getZ(b);if(e&&this._shouldBeBehindOverlay(b,e)){this._applyOverlayZ(e,f),d--;var h=this._overlays[d-1];f=Math.max(this._getZ(h),this._minimumZ)}g<=f&&this._applyOverlayZ(b,f),this._overlays.splice(d,0,b),this.trackBackdrop()},removeOverlay:function(b){var c=this._overlays.indexOf(b);-1===c||(this._overlays.splice(c,1),this.trackBackdrop())},currentOverlay:function(){var b=this._overlays.length-1;return this._overlays[b]},currentOverlayZ:function(){return this._getZ(this.currentOverlay())},ensureMinimumZ:function(b){this._minimumZ=Math.max(this._minimumZ,b)},focusOverlay:function(){var b=this.currentOverlay();b&&b._applyFocus()},trackBackdrop:function(){var b=this._overlayWithBackdrop();(b||this._backdropElement)&&(this.backdropElement.style.zIndex=this._getZ(b)-1,this.backdropElement.opened=!!b)},getBackdrops:function(){for(var b=[],c=0;c<this._overlays.length;c++)this._overlays[c].withBackdrop&&b.push(this._overlays[c]);return b},backdropZ:function(){return this._getZ(this._overlayWithBackdrop())-1},_overlayWithBackdrop:function(){for(var b=0;b<this._overlays.length;b++)if(this._overlays[b].withBackdrop)return this._overlays[b]},_getZ:function(b){var c=this._minimumZ;if(b){var d=+(b.style.zIndex||window.getComputedStyle(b).zIndex);d==d&&(c=d)}return c},_setZ:function(b,c){b.style.zIndex=c},_applyOverlayZ:function(b,c){this._setZ(b,c+2)},_overlayInPath:function(b){b=b||[];for(var c=0;c<b.length;c++)if(b[c]._manager===this)return b[c]},_onCaptureClick:function(b){var c=this.currentOverlay();c&&this._overlayInPath(Polymer.dom(b).path)!==c&&c._onCaptureClick(b)},_onCaptureFocus:function(b){var c=this.currentOverlay();c&&c._onCaptureFocus(b)},_onCaptureKeyDown:function(b){var c=this.currentOverlay();c&&(Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(b,'esc')?c._onCaptureEsc(b):Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(b,'tab')&&c._onCaptureTab(b))},_shouldBeBehindOverlay:function(b,c){return!b.alwaysOnTop&&c.alwaysOnTop}},Polymer.IronOverlayManager=new Polymer.IronOverlayManagerClass;</script></head><body></body></html>