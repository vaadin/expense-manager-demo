<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>vaadin-combo-box resizing tests</title>
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="common.html">
  <script src="common.js"></script>

</head>

<body>

<test-fixture id="combobox">
  <template>
    <vaadin-combo-box label="combobox" style="width: 300px"></vaadin-combo-box>
  </template>
</test-fixture>

<test-fixture id="fixed">
  <template>
    <div style="position:fixed">
      <div>
        <vaadin-combo-box label="combobox" style="width: 300px"></vaadin-combo-box>
      </div>
    </div>
  </template>
</test-fixture>

<script>function moveComboBox(o,e,t){if(comboBox.style.position="fixed",comboBox.style.width=t+"px",comboBox.style.top=e+"px",comboBox.style.left=o+"px",document.createEvent){var n=document.createEvent("Event");n.initEvent("resize",!0,!0),window.dispatchEvent(n)}else{var i=document.createEventObject();element.fireEvent("onresize",i)}}function dropContent(){return comboBox.$.overlay}function dropContentRect(){return dropContent().getBoundingClientRect()}function inputContentRect(){return comboBox.$.inputContainer.getBoundingClientRect()}var comboBox,wh,ww,horiCenter,vertTop,vertBottom;describe("overlay",function(){beforeEach(function(o){return comboBox=fixture("combobox"),comboBox.items=getItemArray(20),wh=window.innerHeight,ww=window.innerWidth,horiCenter=.5*ww,vertTop=0,vertBottom=wh,Polymer.Base.async(o)}),afterEach(function(){comboBox.close()}),describe("overlay position",function(){it("should match the input container width",function(){comboBox.open(),expect(dropContentRect().width).to.be.closeTo(inputContentRect().width,1)}),it("should be below the input box",function(){comboBox.open(),expect(dropContentRect().top).to.be.closeTo(inputContentRect().bottom+comboBox.$.overlay.verticalOffset,1)}),it("should position correctly if items are populated after opening",function(o){comboBox.items=[],comboBox.addEventListener("vaadin-dropdown-opened",function(){comboBox.items=[1,2,3],comboBox.async(function(){expect(dropContentRect().top).to.be.closeTo(inputContentRect().bottom+comboBox.$.overlay.verticalOffset,1),o()},1)}),comboBox.open()}),it("should notify resize on items change",function(){var o=sinon.spy();comboBox.$.overlay.addEventListener("iron-resize",o),comboBox.items=[1,2,3],expect(o.called).to.be["true"]}),it("should be aligned with input container",function(){comboBox.open(),expect(dropContentRect().left).to.equal(inputContentRect().left)}),it("when the input position moves in the view port the overlay position should change",function(){moveComboBox(horiCenter,vertTop,100),comboBox.open(),expect(dropContentRect().left).to.equal(inputContentRect().left),expect(dropContentRect().top).to.be.closeTo(inputContentRect().bottom+comboBox.$.overlay.verticalOffset,1)}),it("when the input position width changes overlay width should change",function(){moveComboBox(horiCenter,vertBottom,150),comboBox.open(),expect(dropContentRect().width).to.equal(inputContentRect().width)}),it("should not translate in sub-pixels",function(){comboBox.style.paddingTop="0.75px",comboBox.open();var o=window.devicePixelRatio||1;expect(comboBox.$.overlay._translateY*o%1).to.closeTo(0,.1),expect(comboBox.$.overlay._translateX*o%1).to.closeTo(0,.1)})}),describeSkipIf(ios,"overlay alignment",function(){beforeEach(function(){comboBox.$.overlay.$.selector.$.items.style.border="none"}),it("should be above input",function(o){moveComboBox(horiCenter,vertBottom,300),comboBox.open(),Polymer.Base.async(function(){expect(dropContent()._alignedAbove).to.be["true"],expect(dropContentRect().bottom).to.closeTo(inputContentRect().top,1),o()},1)}),it("should reposition after filtering",function(o){moveComboBox(horiCenter,vertBottom,300),comboBox.$.input.bindValue="item 1",comboBox.$.input.fire("input"),Polymer.Base.async(function(){expect(dropContentRect().bottom).to.closeTo(inputContentRect().top,1),o()},1)})}),describe("overlay resizing",function(){var o=116,e=2;it("should resize to bottom of the screen",function(){comboBox.open(),moveComboBox(horiCenter,vertBottom-o-inputContentRect().height-e,300),expect(dropContentRect().bottom).to.be.at.most(window.innerHeight)}),it("should resize to top of the screen",function(){moveComboBox(horiCenter,vertBottom,300),comboBox.open(),moveComboBox(horiCenter,o+e,300),expect(dropContentRect().top).to.be.at.least(0)})}),describe("overlay attached/detached callbacks",function(){it("should be called after open and close",function(){var o=comboBox.$.overlay;o.detached=sinon.spy(),o.attached=sinon.spy(),comboBox.open(),sinon.assert.calledOnce(o.detached),sinon.assert.calledOnce(o.attached),sinon.assert.callOrder(o.detached,o.attached),o.detached.reset(),o.attached.reset(),comboBox.close(),sinon.assert.calledOnce(o.detached),sinon.assert.calledOnce(o.attached),sinon.assert.callOrder(o.detached,o.attached)})})}),describe("overlay with fixed position target",function(){function o(o){return window.getComputedStyle(o).position}it("should same position when parent has fixed",function(e){var t=fixture("fixed").querySelector("vaadin-combo-box");t.open(),Polymer.Base.async(function(){expect(o(t.$.overlay)).to.eql("fixed"),e()},1)}),it("should have position absolute",function(e){var t=fixture("combobox");t.open(),Polymer.Base.async(function(){expect(o(t.$.overlay)).to.eql("absolute"),e()},1)})});</script>




</body></html>