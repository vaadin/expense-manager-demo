<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input-container.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../iron-validatable-behavior/iron-validatable-behavior.html">
<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html">
<link rel="import" href="vaadin-combo-box-overlay.html">
<link rel="import" href="vaadin-dropdown-behavior.html">

</head><body><dom-module id="vaadin-combo-box">
  <style>:host{display:block;padding:8px 0;}:host > #overlay{display:none;}paper-input-container{position:relative;padding:0;}paper-input-container[opened]{z-index:20;}paper-input-container div[suffix]{position:absolute;bottom:-4px;right:-4px;width:24px;height:24px;padding:4px;text-align:center;}paper-input-container iron-icon{fill:rgba(0, 0, 0, .38);cursor:pointer;margin-top:-1px;transition:all 0.2s;}paper-input-container paper-ripple{color:rgba(0, 0, 0, .54);}paper-input-container iron-icon:hover,
    paper-input-container[opened] iron-icon{fill:rgba(0, 0, 0, .54);}paper-input-container[opened] iron-icon:hover{fill:rgba(0, 0, 0, .86);}paper-input-container[opened] #toggleIcon iron-icon{-webkit-transform:rotate(180deg);transform:rotate(180deg);}#clearIcon{right:28px;}#clearIcon iron-icon{--iron-icon-width:20px;--iron-icon-height:20px;}[hideclear] #clearIcon{display:none;}#input::-ms-clear{display:none;}#input{box-sizing:border-box;padding-right:28px;}#inputContainer[opened]:not([hideclear]) #input{padding-right:60px;margin-right:-32px;}</style>

  <template>
    <paper-input-container class="dropdown-input" id="inputContainer" disabled$="[[disabled]]" invalid="[[invalid]]" opened$="[[opened]]" hideclear$="[[_hideClearIcon(value, opened)]]" on-down="_preventDefault">
      <label id="label" on-tap="open">[[label]]</label>
      <input is="iron-input" id="input" role="combobox" disabled$="[[disabled]]" readonly$="[[readonly]]" invalid="{{invalid}}" aria-activedescendant$="[[_ariaActiveIndex]]" aria-expanded$="[[_getAriaExpanded(opened)]]" aria-labelledby="label" aria-autocomplete="list" aria-owns="overlay" autocomplete="off" name$="[[name]]" type="text" required$="[[required]]" on-input="_inputValueChanged" on-blur="_onBlur" on-tap="open" key-event-target="">
      <div suffix="" id="clearIcon" on-tap="_clear" on-touchend="_preventDefault">
        <iron-icon icon="clear"></iron-icon>
        <paper-ripple class="circle" center=""></paper-ripple>
      </div>
      <div suffix="" id="toggleIcon" on-tap="_toggle" hidden$="[[_hideToggleIcon(disabled, readonly)]]" on-touchend="_preventDefault">
        <iron-icon icon="arrow-drop-down" aria-controls="overlay"></iron-icon>
        <paper-ripple class="circle" center=""></paper-ripple>
      </div>
    </paper-input-container>

    <vaadin-combo-box-overlay id="overlay" _aria-active-index="{{_ariaActiveIndex}}" position-target="[[_positionTarget]]" _focused-index="[[_focusedIndex]]" _item-label-path="[[itemLabelPath]]" on-down="_onOverlayDown" vertical-offset="2">
    </vaadin-combo-box-overlay>
  </template>
</dom-module>

<script>Polymer({is:"vaadin-combo-box",behaviors:[Polymer.IronFormElementBehavior,Polymer.IronValidatableBehavior,Polymer.IronA11yKeysBehavior,vaadin.elements.combobox.DropdownBehavior],properties:{items:{type:Array},value:{type:String,observer:"_valueChanged",notify:!1},allowCustomValue:{type:Boolean,value:!1},label:{type:String,reflectToAttribute:!0},_positionTarget:{type:Object,value:function(){return this.$.inputContainer}},_focusedIndex:{type:Number,value:-1},_filter:{type:String,value:""},selectedItem:{type:Object,readOnly:!0,notify:!0},itemLabelPath:{type:String,value:"label"},itemValuePath:{type:String,value:"value"}},observers:["_filterChanged(_filter, itemValuePath, itemLabelPath)","_itemsChanged(items.splices)","_setItems(items, itemValuePath, itemLabelPath)"],listeners:{"vaadin-dropdown-opened":"_onOpened","vaadin-dropdown-closed":"_onClosed",keydown:"_onKeyDown"},ready:function(){void 0===this.value&&(this.value=""),Polymer.IronA11yAnnouncer.requestAvailability()},_onKeyDown:function(e){this._isEventKey(e,"down")?(this._onArrowDown(),e.preventDefault()):this._isEventKey(e,"up")?(this._onArrowUp(),e.preventDefault()):this._isEventKey(e,"enter")?this._onEnter(e):this._isEventKey(e,"esc")&&this._onEscape()},_isEventKey:function(e,t){return Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(e,t)},_getItemLabel:function(e){return this.$.overlay.getItemLabel(e)},_getItemValue:function(e){var t=this.get(this.itemValuePath,e);return void 0!==t&&null!==t||(t=e?e.toString():""),t},_onArrowDown:function(){this.opened?this.$.overlay._items&&(this._focusedIndex=Math.min(this.$.overlay._items.length-1,this._focusedIndex+1),this._prefillFocusedItemLabel()):this.open()},_onArrowUp:function(){this.opened?(this._focusedIndex>-1?this._focusedIndex=Math.max(0,this._focusedIndex-1):this.$.overlay._items&&(this._focusedIndex=this.$.overlay._items.length-1),this._prefillFocusedItemLabel()):this.open()},_prefillFocusedItemLabel:function(){this._focusedIndex>-1&&(this.$.input.bindValue=this._getItemLabel(this.$.overlay._focusedItem),this._setSelectionRange())},_onEnter:function(e){this.opened&&(this.allowCustomValue||""===this.$.input.bindValue||this._focusedIndex>-1)&&(this.close(),e.preventDefault())},_onEscape:function(){this.opened&&(this._focusedIndex>-1?(this._focusedIndex=-1,this._revertInputValue()):this.cancel())},_onBlur:function(){this._closeOnBlurIsPrevented||this.close()},_onOverlayDown:function(e){e.preventDefault(),this.$.overlay.touchDevice&&e.target!==this.$.overlay.$.scroller&&(this._closeOnBlurIsPrevented=!0,this.$.input.blur(),this._closeOnBlurIsPrevented=!1)},_toggle:function(){this.opened?this.close():this.open()},_clear:function(){this.value=""},cancel:function(){this.$.input.bindValue=this._getItemLabel(this.selectedItem),this.close()},_onOpened:function(){this.$.overlay.hidden=!this._hasItems(this.$.overlay._items),this.$.overlay.notifyResize(),this.$.overlay.adjustScrollPosition()},_onClosed:function(){if(this._focusedIndex>-1)this.$.overlay._selectItem(this._focusedIndex),this.$.input.bindValue=this._getItemLabel(this.selectedItem);else if(""===this.$.input.bindValue)this._clear();else if(this.allowCustomValue){var e=this.fire("custom-value-set",this.$.input.bindValue,{cancelable:!0});e.defaultPrevented||(this.value=this.$.input.bindValue)}else this.$.input.bindValue=this._getItemLabel(this.selectedItem);this._clearSelectionRange(),this._filter=""},_getAriaExpanded:function(e){return e.toString()},_inputValueChanged:function(e){this._filter===this.$.input.bindValue?this._filterChanged(this._filter):this._filter=this.$.input.bindValue,this.opened||this.open()},_revertInputValue:function(){""!==this._filter?this.$.input.bindValue=this._filter:this.$.input.bindValue=this._getItemLabel(this.selectedItem),this._clearSelectionRange()},_setSelectionRange:function(){this.$.input.setSelectionRange(0,this.$.input.bindValue.length)},_focusedInput:function(){return Polymer.dom(this.root).querySelector("input:focus")},_clearSelectionRange:function(){this._focusedInput()===this.$.input&&this.$.input.setSelectionRange(this.$.input.bindValue.length,this.$.input.bindValue.length)},_filterChanged:function(e){this.unlisten(this.$.overlay,"_selected-item-changed","_selectedItemChanged"),this._setItems(this._filterItems(this.items,e)),this._focusedIndex=this.$.overlay.indexOfLabel(e),this.listen(this.$.overlay,"_selected-item-changed","_selectedItemChanged"),this.async(function(){this.$.overlay.notifyResize()}.bind(this))},_itemsChanged:function(e){e&&e.indexSplices&&this._setItems(e.indexSplices[0].object)},_filterItems:function(e,t){return e?e.filter(function(e){return t=t.toString().toLowerCase()||"",this._getItemLabel(e).toString().toLowerCase().indexOf(t)>-1}.bind(this)):e},_setItems:function(e){this.$.overlay.notifyPath("_items"),this.$.overlay.set("_items",e);var t=this._indexOfValue(this.value,e);t>-1&&this.$.overlay._selectItem(t),this.$.overlay.hidden=!this._hasItems(e),this.$.overlay.notifyResize()},_hasItems:function(e){return e&&e.length},_indexOfValue:function(e,t){if(t=t||this.items,t&&e)for(var i=0;i<t.length;i++)if(this._getItemValue(t[i]).toString()===e.toString())return i;return-1},_selectedItemChanged:function(e,t){null!==t.value&&(this._setSelectedItem(t.value),this.$.input.bindValue=this._getItemLabel(this.selectedItem),this.value=this._getItemValue(this.selectedItem),this._focusedIndex=this.$.overlay._items.indexOf(t.value)),this.opened&&this.close()},_valueChanged:function(e){var t=this._indexOfValue(e),i=t>-1&&this.items[t];this.$.overlay._items&&i&&this.$.overlay._items.indexOf(i)>-1?this.$.overlay._selectItem(i):(this.$.input.bindValue=this.allowCustomValue?e:"",this._setSelectedItem(null),this._focusedIndex=-1,this.$.overlay.$.selector.clearSelection()),this.close()},_hideClearIcon:function(e,t){return""===e||!t},_hideToggleIcon:function(e,t){return t||e},_preventDefault:function(e){e.preventDefault()},_getValidity:function(){return this.$.input.validate()}});</script>
</body></html>