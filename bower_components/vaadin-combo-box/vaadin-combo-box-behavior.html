<html><head><link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html">
<link rel="import" href="vaadin-dropdown-behavior.html">

<script>window.vaadin=window.vaadin||{},vaadin.elements=vaadin.elements||{},vaadin.elements.combobox=vaadin.elements.combobox||{},vaadin.elements.combobox.ComboBoxBehaviorImpl={properties:{items:{type:Array},allowCustomValue:{type:Boolean,value:!1},value:{type:String,observer:"_valueChanged",notify:!1},hasValue:{type:Boolean,value:!1,readonly:!0,reflectToAttribute:!0},_focusedIndex:{type:Number,value:-1},_filter:{type:String,value:""},selectedItem:{type:Object,readOnly:!0,notify:!0},itemLabelPath:{type:String,value:"label"},itemValuePath:{type:String,value:"value"},inputElement:{type:HTMLElement,readOnly:!0},_toggleElement:Object,_clearElement:Object,_inputElementValue:String,_closeOnBlurIsPrevented:Boolean},observers:["_filterChanged(_filter, itemValuePath, itemLabelPath)","_itemsChanged(items.splices)","_setItems(items, itemValuePath, itemLabelPath)"],listeners:{"vaadin-dropdown-opened":"_onOpened","vaadin-dropdown-closed":"_onClosed",keydown:"_onKeyDown",tap:"_onTap"},ready:function(){void 0===this.value&&(this.value=""),Polymer.IronA11yAnnouncer.requestAvailability()},_onBlur:function(){this._closeOnBlurIsPrevented||this.close()},_onOverlayDown:function(e){this.$.overlay.touchDevice&&e.target!==this.$.overlay.$.scroller&&(this._closeOnBlurIsPrevented=!0,this.inputElement.blur(),this._closeOnBlurIsPrevented=!1)},_onTap:function(e){this._closeOnBlurIsPrevented=!0;var t=Polymer.dom(e).path;t.indexOf(this._clearElement)!==-1?this._clear():t.indexOf(this._toggleElement)!==-1?this._toggle():t.indexOf(this.inputElement)!==-1&&this._openAsync(),this._closeOnBlurIsPrevented=!1},_onKeyDown:function(e){this._isEventKey(e,"down")?(this._closeOnBlurIsPrevented=!0,this._onArrowDown(),this._closeOnBlurIsPrevented=!1,e.preventDefault()):this._isEventKey(e,"up")?(this._closeOnBlurIsPrevented=!0,this._onArrowUp(),this._closeOnBlurIsPrevented=!1,e.preventDefault()):this._isEventKey(e,"enter")?this._onEnter(e):this._isEventKey(e,"esc")&&this._onEscape()},_isEventKey:function(e,t){return Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(e,t)},_getItemLabel:function(e){return this.$.overlay.getItemLabel(e)},_getItemValue:function(e){var t=this.get(this.itemValuePath,e);return void 0!==t&&null!==t||(t=e?e.toString():""),t},_onArrowDown:function(){this.opened?this.$.overlay._items&&(this._focusedIndex=Math.min(this.$.overlay._items.length-1,this._focusedIndex+1),this._prefillFocusedItemLabel()):this.open()},_onArrowUp:function(){this.opened?(this._focusedIndex>-1?this._focusedIndex=Math.max(0,this._focusedIndex-1):this.$.overlay._items&&(this._focusedIndex=this.$.overlay._items.length-1),this._prefillFocusedItemLabel()):this.open()},_prefillFocusedItemLabel:function(){this._focusedIndex>-1&&(this._inputElementValue=this._getItemLabel(this.$.overlay._focusedItem),this._setSelectionRange())},_setSelectionRange:function(){this.inputElement.setSelectionRange&&this.inputElement.setSelectionRange(0,this._inputElementValue.length)},_onEnter:function(e){this.opened&&(this.allowCustomValue||""===this._inputElementValue||this._focusedIndex>-1)&&(this.close(),e.preventDefault())},_onEscape:function(){this.opened&&(this._focusedIndex>-1?(this._focusedIndex=-1,this._revertInputValue()):this.cancel())},_openAsync:function(){this.async(this.open)},_toggle:function(){this.opened?this.close():this.open()},_clear:function(){this.value=""},cancel:function(){this._inputElementValue=this._getItemLabel(this.selectedItem),this.close()},_onOpened:function(){this.$.overlay.hidden=!this._hasItems(this.$.overlay._items),this.$.overlay.notifyResize(),this.$.overlay.adjustScrollPosition()},_onClosed:function(){if(this._focusedIndex>-1)this.$.overlay._selectItem(this._focusedIndex),this._inputElementValue=this._getItemLabel(this.selectedItem);else if(""===this._inputElementValue)this._clear();else if(this.allowCustomValue){var e=this.fire("custom-value-set",this._inputElementValue,{cancelable:!0});e.defaultPrevented||(this.value=this._inputElementValue)}else this._inputElementValue=this._getItemLabel(this.selectedItem);this._clearSelectionRange(),this._filter=""},_inputValueChanged:function(e){Polymer.dom(e).path.indexOf(this.inputElement)!==-1&&(this._filter===this._inputElementValue?this._filterChanged(this._filter):this._filter=this._inputElementValue,this.opened||this.open())},_clearSelectionRange:function(){if(this._focusedInput()===this.inputElement&&this.inputElement.setSelectionRange){var e=this._inputElementValue?this._inputElementValue.length:0;this.inputElement.setSelectionRange(e,e)}},_focusedInput:function(){return Polymer.dom(this).querySelector("input:focus")||Polymer.dom(this.root).querySelector("input:focus")},_filterChanged:function(e){this.unlisten(this.$.overlay,"_selected-item-changed","_selectedItemChanged"),this._setItems(this._filterItems(this.items,e)),this._focusedIndex=this.$.overlay.indexOfLabel(e),this.listen(this.$.overlay,"_selected-item-changed","_selectedItemChanged"),this.async(function(){this.$.overlay.notifyResize()}.bind(this))},_revertInputValue:function(){""!==this._filter?this._inputElementValue=this._filter:this._inputElementValue=this._getItemLabel(this.selectedItem),this._clearSelectionRange()},_valueChanged:function(e){this.hasValue=!!e;var t=this._indexOfValue(e),i=t>-1&&this.items[t];this.$.overlay._items&&i&&this.$.overlay._items.indexOf(i)>-1?this.$.overlay._selectItem(i):(this._inputElementValue=this.allowCustomValue?e:"",this._setSelectedItem(null),this._focusedIndex=-1,this.$.overlay.$.selector.clearSelection()),this.fire("change",void 0,{bubbles:!0}),this.close()},_itemsChanged:function(e){e&&e.indexSplices&&this._setItems(e.indexSplices[0].object)},_filterItems:function(e,t){return e?e.filter(function(e){return t=t.toString().toLowerCase()||"",this._getItemLabel(e).toString().toLowerCase().indexOf(t)>-1}.bind(this)):e},_setItems:function(e){this.$.overlay.notifyPath("_items",void 0),this.$.overlay.set("_items",e);var t=this._indexOfValue(this.value,e);t>-1&&this.$.overlay._selectItem(t),this.$.overlay.hidden=!this._hasItems(e),this.$.overlay.notifyResize()},_hasItems:function(e){return e&&e.length},_indexOfValue:function(e,t){if(t=t||this.items,t&&e)for(var i=0;i<t.length;i++)if(this._getItemValue(t[i]).toString()===e.toString())return i;return-1},_selectedItemChanged:function(e,t){null!==t.value&&(this._setSelectedItem(t.value),this._inputElementValue=this._getItemLabel(this.selectedItem),this.value=this._getItemValue(this.selectedItem),this._focusedIndex=this.$.overlay._items.indexOf(t.value)),this.opened&&this.close()},_getValidity:function(){if(this.inputElement.validate)return this.inputElement.validate()},_preventDefault:function(e){e.preventDefault()},_stopPropagation:function(e){e.stopPropagation()}},vaadin.elements.combobox.ComboBoxBehavior=[Polymer.IronFormElementBehavior,vaadin.elements.combobox.DropdownBehavior,vaadin.elements.combobox.ComboBoxBehaviorImpl];</script>
</head><body></body></html>