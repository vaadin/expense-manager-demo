<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>vaadin-combo basic tests</title>
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="common.html">
  <script src="common.js"></script>
  <style>body{-webkit-text-size-adjust:100%;}</style>
</head>

<body>

<test-fixture id="combobox">
  <template>
    <vaadin-combo-box></vaadin-combo-box>
  </template>
</test-fixture>

<script>describe("keyboard navigation",function(){function e(){return s.$.input}function t(t){e().bindValue=t,e().fire("input")}function o(){return s._focusedIndex}function n(){MockInteractions.keyDownOn(e(),40)}function i(){MockInteractions.keyDownOn(e(),38)}function l(){MockInteractions.pressEnter(e())}function c(){MockInteractions.keyDownOn(e(),27)}var s;beforeEach(function(){s=fixture("combobox"),s.items=["foo","bar","baz"]}),describe("opening the overlay",function(){it("should open the overlay with arrow down and not focus any item",function(){n(),expect(s.opened).to.equal(!0),expect(o()).to.equal(-1)}),it("should open the overlay with arrow up and not focus any item",function(){i(),expect(s.opened).to.equal(!0),expect(o()).to.equal(-1)}),it("should have focus on the selected item after opened",function(){s.value="foo",n(),expect(o()).to.equal(0)})}),describe("navigating the items after overlay opened",function(){beforeEach(function(){n()}),it("should focus on the first item with arrow down",function(){n(),expect(o()).to.equal(0)}),it("should focus on the last item with up arrow",function(){i(),expect(o()).to.equal(2)}),it("should focus on the previous item with arrow up",function(){n(),n(),i(),expect(o()).to.equal(0)}),it("should not go below the last item",function(){n(),n(),n(),expect(o()).to.equal(2),n(),expect(o()).to.equal(2)}),it("should not remove focus",function(){n(),i(),expect(o()).to.equal(0)}),it("should focus only on filtered items",function(){t("foo"),n(),expect(o()).to.equal(0),n(),expect(o()).to.equal(0)})}),describe("selecting items",function(){beforeEach(function(){s.value="bar",n()}),it("should select focused item with enter",function(){n(),l(),expect(s.value).to.equal("baz")}),it("should clear the selection with enter when input is cleared",function(){t(""),l(),expect(s.value).to.eql("")}),it("should clear the selection with enter when input is undefined",function(){t(void 0),l(),expect(s.value).to.eql("")}),it("should close the overlay with enter when custom values are allowed",function(){s.allowCustomValue=!0,t("foobar"),l(),expect(s.value).to.equal("foobar"),expect(s.opened).to.equal(!1)}),it("should not close the overlay with enter when custom values are not allowed",function(){t("foobar"),l(),expect(s.value).to.equal("bar"),expect(s.opened).to.equal(!0)}),it("should close the overlay with enter",function(){l(),expect(s.opened).to.equal(!1)}),it("should remove focus with espace",function(){s._focusedIndex=0,c(),expect(s.opened).to.equal(!0),expect(s._focusedIndex).to.eql(-1)}),it("should close the overlay with escape if there is no focus",function(){s._focusedIndex=-1,c(),expect(s.opened).to.equal(!1)}),it("should cancel typing with escape",function(){t("baz"),c(),expect(s.value).to.equal("bar")}),it("should select typed item",function(){t("baz"),l(),expect(s.value).to.equal("baz")}),it("should prefill the input field when navigating down",function(){n(),expect(e().bindValue).to.eql("baz")}),it("should select the input field text when navigating down",function(){n(),expect(e().selectionStart).to.eql(0),expect(e().selectionEnd).to.eql(3)}),it("should prefill the input field when navigating up",function(){i(),expect(e().bindValue).to.eql("foo")}),it("should not prefill the input when there are no items to navigate",function(){t("invalid filter"),n(),expect(e().bindValue).to.eql("invalid filter")}),it("should select the input field text when navigating up",function(){i(),expect(e().selectionStart).to.eql(0),expect(e().selectionEnd).to.eql(3)}),it("should revert back to filter with espace",function(){t("b"),n(),expect(e().bindValue).to.eql("bar"),c(),expect(e().bindValue).to.eql("b")}),it("should remove selection from the input value when reverting",function(){t("b"),n(),c(),expect(e().selectionStart).to.eql(e().selectionEnd)}),it("should revert back to value if there is no filter",function(){n(),c(),expect(e().bindValue).to.eql("bar")}),safari||touchDevice||it("should remove selection from the input value selecting value",function(){n(),l(),expect(e().selectionStart).to.eql(3),expect(e().selectionEnd).to.eql(3)})}),describe("sanity checks for calculating visible item counts",function(){it("should calculate items correctly when all items are visible",function(e){s.items=["foo","bar","baz","qux"],s.open(),Polymer.Base.async(function(){expect(s.$.overlay._visibleItemsCount()).to.eql(4),expect(s.$.overlay._lastVisibleIndex()).to.eql(3),e()})}),it("should calculate items correctly when some items are hidden",function(e){for(var t=[],o=0;100>o;o++)t.push(o.toString());s.items=t,s.open(),Polymer.Base.async(function(){expect(s.$.overlay._lastVisibleIndex()).to.eql(s.$.overlay._visibleItemsCount()-1),e()})})}),describe("scrolling items",function(){var e;beforeEach(function(t){for(var o=[],n=0;100>n;n++)o.push(n.toString());s.items=o,s.open(),e=s.$.overlay.$.selector,Polymer.Base.async(t)}),it("should scroll down after reaching the last visible item",function(){s._focusedIndex=s.$.overlay._visibleItemsCount()-1,expect(e.firstVisibleIndex).to.eql(0),n(),expect(e.firstVisibleIndex).to.eql(1)}),it("should scroll up after reaching the first visible item",function(){s._focusedIndex=1,e.scrollToIndex(1),expect(e.firstVisibleIndex).to.eql(1),i(),expect(e.firstVisibleIndex).to.eql(0)}),it("should scroll to first visible when navigating down above viewport",function(){s._focusedIndex=5,e.scrollToIndex(50),n(),expect(e.firstVisibleIndex).to.eql(6)}),it("should scroll to first visible when navigating up above viewport",function(){s._focusedIndex=5,e.scrollToIndex(50),i(),expect(e.firstVisibleIndex).to.eql(4)}),it("should scroll to last visible when navigating up below viewport",function(){s._focusedIndex=50,e.scrollToIndex(0),expect(e.firstVisibleIndex).to.eql(0),i(),expect(e.firstVisibleIndex).to.eql(49-s.$.overlay._visibleItemsCount()+1)}),it("should scroll to last visible when navigating down below viewport",function(){s._focusedIndex=50,e.scrollToIndex(0),expect(e.firstVisibleIndex).to.eql(0),n(),expect(e.firstVisibleIndex).to.eql(51-s.$.overlay._visibleItemsCount()+1)}),it("should scroll to start if no items focused when opening overlay",function(t){e.scrollToIndex(50),s.close(),s.open(),Polymer.Base.async(function(){expect(e.firstVisibleIndex).to.eql(0),t()})}),it("should scroll to focused item when opening overlay",function(t){e.scrollToIndex(0),s.close(),s.value="50",s.open(),Polymer.Base.async(function(){expect(e.firstVisibleIndex).to.be.within(50-s.$.overlay._visibleItemsCount(),50),t()})})})});</script>




</body></html>