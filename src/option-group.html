<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/vaadin-checkbox/vaadin-checkbox.html">

<dom-module id="option-group">
  <template>
    <style>
      :host {
        display: block;
      }

      .caption {
        font-size: 12px;
        margin: 32px 0 14px;
        color: rgba(0, 0, 0, 0.54);
      }
    </style>

    <div class="caption">[[caption]]</div>
    <template is="dom-repeat" items="[[items]]">
      <vaadin-checkbox checked="[[_isChecked(item, value)]]" data-value$="[[_getValue(item)]]" on-checked-changed="_updateValue">[[_getLabel(item)]]</vaadin-checkbox>
    </template>

  </template>
  <script>
    (function() {
      class OptionGroupElement extends Polymer.Element {
        static get is() {
          return 'option-group';
        }

        static get properties() {
          return {
            items: Array,
            labelPath: String,
            valuePath: String,
            value: {
              type: Array,
              notify: true,
              value: () => []
            },
            caption: String
          };
        }

        _isChecked(item) {
          return this.value.some(val => {
            return val === this._getValue(item);
          });
        }

        _getValue(item) {
          return this.valuePath ? item[this.valuePath] : item;
        }

        _getLabel(item) {
          return this.labelPath ? item[this.labelPath] : item;
        }

        _updateValue() {
          this.value = [...this.root.querySelectorAll('vaadin-checkbox')]
            .filter(cb => cb.checked)
            .map(cb => cb.dataset.value);
        }
      }

      customElements.define(OptionGroupElement.is, OptionGroupElement);

      /**
       * @namespace ExpenseManager
       */
      window.ExpenseManager = window.ExpenseManager || {};
      ExpenseManager.OptionGroupElement = OptionGroupElement;
    })();
  </script>
</dom-module>
